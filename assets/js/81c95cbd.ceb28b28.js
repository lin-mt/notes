"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[9432],{3801:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>d});var l=s(4848),i=s(8453);const c={sidebar_position:1},r="Debian 12 \u90e8\u7f72 k8s",t={id:"dev-ops/k8s/deploy/debian12",title:"Debian 12 \u90e8\u7f72 k8s",description:"\u51c6\u5907",source:"@site/docs/dev-ops/k8s/deploy/debian12.md",sourceDirName:"dev-ops/k8s/deploy",slug:"/dev-ops/k8s/deploy/debian12",permalink:"/notes/docs/dev-ops/k8s/deploy/debian12",draft:!1,unlisted:!1,editUrl:"https://github.com/lin-mt/notes/tree/main/docs/dev-ops/k8s/deploy/debian12.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"devOpsK8S",previous:{title:"\u7b80\u4ecb",permalink:"/notes/docs/dev-ops/k8s/"},next:{title:"Debian 12 \u4f7f\u7528 RKE2 \u79bb\u7ebf\u90e8\u7f72 k8s",permalink:"/notes/docs/dev-ops/k8s/deploy/debian-rke2"}},a={},d=[{value:"\u51c6\u5907",id:"\u51c6\u5907",level:2},{value:"\u670d\u52a1\u5668\u914d\u7f6e",id:"\u670d\u52a1\u5668\u914d\u7f6e",level:3},{value:"\u670d\u52a1\u5668\u8bbe\u7f6e",id:"\u670d\u52a1\u5668\u8bbe\u7f6e",level:3},{value:"\u7981\u7528<code>selinux</code>",id:"\u7981\u7528selinux",level:4},{value:"\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757",id:"\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757",level:4},{value:"\u670d\u52a1\u5668\u652f\u6301<code>ipvs</code>",id:"\u670d\u52a1\u5668\u652f\u6301ipvs",level:4},{value:"\u5b89\u88c5<code>ipset</code>\u548c<code>ipvsadm</code>",id:"\u5b89\u88c5ipset\u548cipvsadm",level:4},{value:"\u90e8\u7f72 K8S",id:"\u90e8\u7f72-k8s",level:2},{value:"\u90e8\u7f72\u5bb9\u5668\u8fd0\u884c\u65f6<code>Containerd</code>",id:"\u90e8\u7f72\u5bb9\u5668\u8fd0\u884c\u65f6containerd",level:3},{value:"\u5b89\u88c5<code>kubeadm</code>\u548c<code>kubelet</code>",id:"\u5b89\u88c5kubeadm\u548ckubelet",level:3},{value:"\u521d\u59cb\u5316\u96c6\u7fa4",id:"\u521d\u59cb\u5316\u96c6\u7fa4",level:3},{value:"\u5b89\u88c5\u5305\u7ba1\u7406\u5668<code>Helm</code>",id:"\u5b89\u88c5\u5305\u7ba1\u7406\u5668helm",level:3},{value:"\u90e8\u7f72Pod Network\u7ec4\u4ef6<code>Calico</code>",id:"\u90e8\u7f72pod-network\u7ec4\u4ef6calico",level:3},{value:"\u9a8c\u8bc1k8s DNS\u662f\u5426\u53ef\u7528",id:"\u9a8c\u8bc1k8s-dns\u662f\u5426\u53ef\u7528",level:3},{value:"\u5176\u4ed6\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",id:"\u5176\u4ed6\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",level:3},{value:"\u5e38\u7528\u7ec4\u4ef6\u90e8\u7f72",id:"\u5e38\u7528\u7ec4\u4ef6\u90e8\u7f72",level:2},{value:"\u90e8\u7f72<code>ingress-nginx</code>",id:"\u90e8\u7f72ingress-nginx",level:3},{value:"\u95ee\u9898",id:"\u95ee\u9898",level:2},{value:"\u5b89\u88c5 kubeadm \u548c kubectl \u65f6\u65e0\u6cd5\u751f\u6210 <code>kubernetes-apt-keyring.gpg</code>",id:"\u5b89\u88c5-kubeadm-\u548c-kubectl-\u65f6\u65e0\u6cd5\u751f\u6210-kubernetes-apt-keyringgpg",level:3},{value:"\u5b89\u88c5 Calico \u540e\u6ca1\u6709\u770b\u5230<code>calico-system</code>\u76f8\u5173\u7684 pod",id:"\u5b89\u88c5-calico-\u540e\u6ca1\u6709\u770b\u5230calico-system\u76f8\u5173\u7684-pod",level:3},{value:"\u90e8\u7f72ingress-nginx\u65f6\uff0cpod \u4e00\u76f4\u5904\u4e8e Pending \u72b6\u6001",id:"\u90e8\u7f72ingress-nginx\u65f6pod-\u4e00\u76f4\u5904\u4e8e-pending-\u72b6\u6001",level:3},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2},{value:"\u5176\u4ed6",id:"\u5176\u4ed6",level:2},{value:"\u4e0d\u4f7f\u7528 Calico \u9ed8\u8ba4\u7684 pod \u5b50\u7f51 192.168.0.0/16",id:"\u4e0d\u4f7f\u7528-calico-\u9ed8\u8ba4\u7684-pod-\u5b50\u7f51-1921680016",level:3}];function o(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"debian-12-\u90e8\u7f72-k8s",children:"Debian 12 \u90e8\u7f72 k8s"}),"\n",(0,l.jsx)(n.h2,{id:"\u51c6\u5907",children:"\u51c6\u5907"}),"\n",(0,l.jsx)(n.h3,{id:"\u670d\u52a1\u5668\u914d\u7f6e",children:"\u670d\u52a1\u5668\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"\u4e09\u53f0\u670d\u52a1\u5668\uff0c\u6bcf\u53f0\u670d\u52a1\u5668\u5185\u5b582GB\u6216\u66f4\u591a\uff0cCPU2\u6838\u6216\u66f4\u591a\uff0c\u786c\u76d830GB\u6216\u66f4\u591a"}),"\n",(0,l.jsx)(n.h3,{id:"\u670d\u52a1\u5668\u8bbe\u7f6e",children:"\u670d\u52a1\u5668\u8bbe\u7f6e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{style:{textAlign:"center"},children:"ip"}),(0,l.jsx)(n.th,{style:{textAlign:"center"},children:"hostname"}),(0,l.jsx)(n.th,{style:{textAlign:"center"},children:"role"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"center"},children:"10.211.55.15"}),(0,l.jsx)(n.td,{style:{textAlign:"center"},children:"node15"}),(0,l.jsx)(n.td,{style:{textAlign:"center"},children:"master"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"center"},children:"10.211.55.16"}),(0,l.jsx)(n.td,{style:{textAlign:"center"},children:"node16"}),(0,l.jsx)(n.td,{style:{textAlign:"center"},children:"worker"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"center"},children:"10.211.55.17"}),(0,l.jsx)(n.td,{style:{textAlign:"center"},children:"node17"}),(0,l.jsx)(n.td,{style:{textAlign:"center"},children:"worker"})]})]})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"hostnamectl set-hostname node15\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"hostnamectl set-hostname node16\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"hostnamectl set-hostname node17\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat << EOF > /etc/hosts\n10.211.55.15  node15\n10.211.55.16  node16\n10.211.55.17  node17\nEOF\n"})}),"\n",(0,l.jsxs)(n.h4,{id:"\u7981\u7528selinux",children:["\u7981\u7528",(0,l.jsx)(n.code,{children:"selinux"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u670d\u52a1\u5668\u5982\u679c\u542f\u7528\u4e86 ",(0,l.jsx)(n.code,{children:"selinux"})," \u5219\u7981\u7528 ",(0,l.jsx)(n.code,{children:"selinux"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"setenforce 0\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"vi /etc/selinux/config\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5c06\u6587\u4ef6\u4e2d SELINUX \u6539\u4e3a disable\uff1a",(0,l.jsx)(n.code,{children:"SELINUX=disabled"})]}),"\n",(0,l.jsx)(n.h4,{id:"\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757",children:"\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d\u5185\u6838\u6a21\u5757"}),"\n",(0,l.jsx)(n.p,{children:"\u7cfb\u7edf\u542f\u52a8\u65f6\u81ea\u52a8\u52a0\u8f7d\u6240\u9700\u7684\u5185\u6838\u6a21\u5757\uff0c\u4ee5\u6ee1\u8db3\u5bb9\u5668\u8fd0\u884c\u65f6\u7684\u8981\u6c42\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat << EOF > /etc/modules-load.d/containerd.conf\noverlay\nbr_netfilter\nEOF\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u4ee5\u4e0a\u914d\u7f6e\u751f\u6548"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:"cpoy",children:"modprobe overlay\nmodprobe br_netfilter\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u521b\u5efa/etc/sysctl.d/99-kubernetes-cri.conf\u914d\u7f6e\u6587\u4ef6\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat << EOF > /etc/sysctl.d/99-kubernetes-cri.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nuser.max_user_namespaces=28633\nEOF\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u4ee5\u4e0a\u914d\u7f6e\u751f\u6548"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sysctl -p /etc/sysctl.d/99-kubernetes-cri.conf\n"})}),"\n",(0,l.jsxs)(n.h4,{id:"\u670d\u52a1\u5668\u652f\u6301ipvs",children:["\u670d\u52a1\u5668\u652f\u6301",(0,l.jsx)(n.code,{children:"ipvs"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat > /etc/modules-load.d/ipvs.conf <<EOF\nip_vs\nip_vs_rr\nip_vs_wrr\nip_vs_sh\nEOF\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u4ee5\u4e0a\u914d\u7f6e\u7acb\u5373\u751f\u6548\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"modprobe ip_vs\nmodprobe ip_vs_rr\nmodprobe ip_vs_wrr\nmodprobe ip_vs_sh\n"})}),"\n",(0,l.jsxs)(n.h4,{id:"\u5b89\u88c5ipset\u548cipvsadm",children:["\u5b89\u88c5",(0,l.jsx)(n.code,{children:"ipset"}),"\u548c",(0,l.jsx)(n.code,{children:"ipvsadm"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"apt install -y ipset ipvsadm\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u90e8\u7f72-k8s",children:"\u90e8\u7f72 K8S"}),"\n",(0,l.jsxs)(n.h3,{id:"\u90e8\u7f72\u5bb9\u5668\u8fd0\u884c\u65f6containerd",children:["\u90e8\u7f72\u5bb9\u5668\u8fd0\u884c\u65f6",(0,l.jsx)(n.code,{children:"Containerd"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"wget https://github.com/containerd/containerd/releases/download/v1.7.11/containerd-1.7.11-linux-amd64.tar.gz\ntar Cxzvf /usr/local containerd-1.7.11-linux-amd64.tar.gz\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5b89\u88c5",(0,l.jsx)(n.code,{children:"runc"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"wget https://github.com/opencontainers/runc/releases/download/v1.1.9/runc.amd64\ninstall -m 755 runc.amd64 /usr/local/sbin/runc\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u751f\u6210",(0,l.jsx)(n.code,{children:"containerd"}),"\u7684\u914d\u7f6e\u6587\u4ef6:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mkdir -p /etc/containerd\ncontainerd config default > /etc/containerd/config.toml\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5c06\u6587\u4ef6",(0,l.jsx)(n.code,{children:"/etc/containerd/config.toml"}),"\u4e2d\u7684",(0,l.jsx)(n.code,{children:"SystemdCgroup"}),"\u914d\u7f6e\u6539\u4e3a",(0,l.jsx)(n.code,{children:"true"}),"\uff0c",(0,l.jsx)(n.code,{children:"sandbox_image"}),"\u6539\u4e3a",(0,l.jsx)(n.code,{children:"registry.aliyuncs.com/google_containers/pause:3.9"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-toml",children:'[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]\n  ...\n  [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]\n    SystemdCgroup = true\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-toml",children:'[plugins."io.containerd.grpc.v1.cri"]\n  ...\n  # sandbox_image = "registry.k8s.io/pause:3.8"\n  sandbox_image = "registry.aliyuncs.com/google_containers/pause:3.9"\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u4e3a\u4e86\u901a\u8fc7",(0,l.jsx)(n.code,{children:"systemd"}),"\u542f\u52a8",(0,l.jsx)(n.code,{children:"containerd"}),"\uff0c\u9700\u8981\u4ece ",(0,l.jsx)(n.code,{children:"https://raw.githubusercontent.com/containerd/containerd/main/containerd.service"})," \u4e0b\u8f7d",(0,l.jsx)(n.code,{children:"containerd.service"}),"\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u653e\u7f6e\u5728",(0,l.jsx)(n.code,{children:"/etc/systemd/system/containerd.service"}),"\u4e2d\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat << EOF > /etc/systemd/system/containerd.service\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/local/bin/containerd\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\n\n# Comment TasksMax if your systemd version does not supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target\nEOF\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u914d\u7f6e",(0,l.jsx)(n.code,{children:"containerd"}),"\u5f00\u673a\u542f\u52a8\uff0c\u5e76\u542f\u52a8",(0,l.jsx)(n.code,{children:"containerd"}),"\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"systemctl daemon-reload\nsystemctl enable containerd --now\nsystemctl status containerd\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u4e0b\u8f7d\u5b89\u88c5",(0,l.jsx)(n.code,{children:"crictl"}),"\u5de5\u5177"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"wget https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.29.0/crictl-v1.29.0-linux-amd64.tar.gz\ntar -zxvf crictl-v1.29.0-linux-amd64.tar.gz\ninstall -m 755 crictl /usr/local/bin/crictl\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6d4b\u8bd5\u662f\u5426\u5b89\u88c5\u6210\u529f\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"crictl --runtime-endpoint=unix:///run/containerd/containerd.sock  version\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8f93\u51fa\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"Version:  0.1.0\nRuntimeName:  containerd\nRuntimeVersion:  v1.7.11\nRuntimeApiVersion:  v1\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"\u5b89\u88c5kubeadm\u548ckubelet",children:["\u5b89\u88c5",(0,l.jsx)(n.code,{children:"kubeadm"}),"\u548c",(0,l.jsx)(n.code,{children:"kubelet"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"apt-get update\n\napt-get install -y apt-transport-https ca-certificates curl gpg gnupg\n\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\n\necho 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list\n\napt-get update\n\napt install kubelet kubeadm kubectl\n\napt-mark hold kubelet kubeadm kubectl\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u6240\u6709\u8282\u70b9\u5f00\u542f\u542f\u52a8",(0,l.jsx)(n.code,{children:"kubelet"}),"\u670d\u52a1"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"systemctl enable kubelet.service\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u521d\u59cb\u5316\u96c6\u7fa4",children:"\u521d\u59cb\u5316\u96c6\u7fa4"}),"\n",(0,l.jsx)(n.p,{children:"\u83b7\u53d6\u96c6\u7fa4\u521d\u59cb\u5316\u7684\u9ed8\u8ba4\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubeadm config print init-defaults --component-configs KubeletConfiguration >> kubeadm.yaml\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4fee\u6539\u96c6\u7fa4\u9ed8\u8ba4\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="kubeadm.yaml" showLineNumbers {20,34,41,92-94}',children:'apiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n  - system:bootstrappers:kubeadm:default-node-token\n  # token \u53ef\u81ea\u5b9a\u4e49\n  token: abcdef.0123456789abcdef\n  ttl: 24h0m0s\n  usages:\n  - signing\n  - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  # \u4e3b\u8282\u70b9IP\n  advertiseAddress: 10.211.55.15\n  bindPort: 6443\nnodeRegistration:\n  criSocket: unix:///var/run/containerd/containerd.sock\n  imagePullPolicy: IfNotPresent\n  # \u4e3b\u8282\u70b9 hostname\n  name: node15\n  taints: null\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns: {}\netcd:\n  local:\n    dataDir: /var/lib/etcd\n# \u4f7f\u7528\u963f\u91cc\u955c\u50cf\uff0c\u907f\u514d\u56e0 gcr \u88ab\u5899\u65e0\u6cd5\u4e0b\u8f7d\u955c\u50cf\nimageRepository: registry.aliyuncs.com/google_containers\nkind: ClusterConfiguration\nkubernetesVersion: 1.29.0\nnetworking:\n  dnsDomain: cluster.local\n  serviceSubnet: 10.96.0.0/12\n  # Calico\uff08Pod\u7f51\u7edc\u7ec4\u4ef6\uff09\u9ed8\u8ba4\u7684\u5b50\u7f51\n  podSubnet: 192.168.0.0/16\nscheduler: {}\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\ncgroupDriver: systemd\nfailSwapOn: false\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncontainerRuntimeEndpoint: ""\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMaximumGCAge: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\nlogging:\n  flushFrequency: 0\n  options:\n    json:\n      infoBufferSize: "0"\n  verbosity: 0\nmemorySwap: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\n---\n# \u8bbe\u7f6ekube-proxy\u4ee3\u7406\u6a21\u5f0f\u4e3aipvs\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: ipvs\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u5404\u4e2a\u8282\u70b9\u9884\u5148\u62c9\u53d6\u955c\u50cf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubeadm config images pull --config kubeadm.yaml\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u4f7f\u7528",(0,l.jsx)(n.code,{children:"kubeadm"}),"\u5728\u4e3b\u8282\u70b9\u521d\u59cb\u5316\u96c6\u7fa4"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"kubeadm init --config kubeadm.yaml\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u6839\u636e\u521d\u59cb\u5316\u96c6\u7fa4\u547d\u4ee4\u7684\u8f93\u51fa\u5185\u5bb9\u53ef\u4ee5\u8bbe\u7f6e",(0,l.jsx)(n.code,{children:"kubectl"}),"\u5de5\u5177\u8bbf\u95ee\u96c6\u7fa4\u7684\u914d\u7f6e"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6839\u636e\u521d\u59cb\u5316\u96c6\u7fa4\u547d\u4ee4\u7684\u8f93\u51fa\u5185\u5bb9\uff0c\u540e\u7eed\u53ef\u4ee5\u5728\u5176\u4ed6\u670d\u52a1\u5668\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u52a0\u5165\u96c6\u7fa4"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubeadm join 10.211.55.15:6443 --token abcdef.0123456789abcdef \\\n --discovery-token-ca-cert-hash sha256:9c0eb6268da17c2ca1394adc31fd0a1bd0adf4f0f59e1610a274d4c3dbe33a44\n"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\u96c6\u7fa4\u521d\u59cb\u5316\u5982\u679c\u9047\u5230\u95ee\u9898\uff0c\u53ef\u4ee5\u4f7f\u7528",(0,l.jsx)(n.code,{children:"kubeadm reset"}),"\u547d\u4ee4\u8fdb\u884c\u6e05\u7406"]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"\u5b89\u88c5\u5305\u7ba1\u7406\u5668helm",children:["\u5b89\u88c5\u5305\u7ba1\u7406\u5668",(0,l.jsx)(n.code,{children:"Helm"})]}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u5148\u5728 master \u8282\u70b9\u5b89\u88c5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"wget https://get.helm.sh/helm-v3.13.3-linux-amd64.tar.gz\ntar -zxvf helm-v3.13.3-linux-amd64.tar.gz\ninstall -m 755 linux-amd64/helm  /usr/local/bin/helm\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u9a8c\u8bc1",(0,l.jsx)(n.code,{children:"helm"}),"\u662f\u5426\u5b89\u88c5\u6210\u529f"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"helm list\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"\u90e8\u7f72pod-network\u7ec4\u4ef6calico",children:["\u90e8\u7f72Pod Network\u7ec4\u4ef6",(0,l.jsx)(n.code,{children:"Calico"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u4e0b\u8f7d",(0,l.jsx)(n.code,{children:"tigera-operator"}),"\u7684helm chart:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"wget https://github.com/projectcalico/calico/releases/download/v3.27.0/tigera-operator-v3.27.0.tgz\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5bfc\u51fa\u5b89\u88c5",(0,l.jsx)(n.code,{children:"Calico"}),"\u7684\u9ed8\u8ba4\u914d\u7f6e"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"helm show values tigera-operator-v3.27.0.tgz >> values.yaml\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u4f7f\u7528",(0,l.jsx)(n.code,{children:"helm"}),"\u5b89\u88c5",(0,l.jsx)(n.code,{children:"calico"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"helm install calico tigera-operator-v3.27.0.tgz -n kube-system  --create-namespace -f values.yaml\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u7b49\u5f85",(0,l.jsx)(n.code,{children:"calico"}),"\u76f8\u5173\u7684\u6240\u6709",(0,l.jsx)(n.code,{children:"Pod"}),"\u5904\u4e8e",(0,l.jsx)(n.code,{children:"Running"}),"\u72b6\u6001"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"kubectl get pod -n kube-system | grep tigera-operator\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"root@node15:~# kubectl get pod -n kube-system | grep tigera-operator\ntigera-operator-55585899bf-c8fnt   1/1     Running   1 (37m ago)   23h\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"kubectl get pods -n calico-system\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"root@node15:~# kubectl get pods -n calico-system\nNAME                                       READY   STATUS    RESTARTS      AGE\ncalico-kube-controllers-799f47b4c9-lzfhq   1/1     Running   1 (37m ago)   23h\ncalico-node-6w4g5                          1/1     Running   1 (37m ago)   23h\ncalico-node-gprgp                          1/1     Running   1 (37m ago)   23h\ncalico-node-ks5bm                          1/1     Running   1 (37m ago)   23h\ncalico-typha-6fbccccb4b-kfs44              1/1     Running   1 (37m ago)   23h\ncalico-typha-6fbccccb4b-rfbrd              1/1     Running   1 (37m ago)   23h\ncsi-node-driver-9lqsn                      2/2     Running   2 (37m ago)   23h\ncsi-node-driver-q75s5                      2/2     Running   2 (37m ago)   23h\ncsi-node-driver-qtz27                      2/2     Running   2 (37m ago)   23h\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5c06",(0,l.jsx)(n.code,{children:"calicoctl"}),"\u5b89\u88c5\u4e3a",(0,l.jsx)(n.code,{children:"kubectl"}),"\u7684\u63d2\u4ef6\uff0c\u4f7f\u7528",(0,l.jsx)(n.code,{children:"calicoctl"}),"\u7ba1\u7406",(0,l.jsx)(n.code,{children:"calico"}),"\u5411k8s\u4e2d\u6dfb\u52a0\u7684api\u8d44\u6e90:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:'cd /usr/local/bin\ncurl -o kubectl-calico -O -L  "https://github.com/projectcalico/calico/releases/download/v3.27.0/calicoctl-linux-amd64"\nchmod +x kubectl-calico\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u9a8c\u8bc1\u5b89\u88c5\u662f\u5426\u6210\u529f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"kubectl calico -h\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u9a8c\u8bc1k8s-dns\u662f\u5426\u53ef\u7528",children:"\u9a8c\u8bc1k8s DNS\u662f\u5426\u53ef\u7528"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"kubectl run curl --image=radial/busyboxplus:curl -it\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"root@node15:~# kubectl run curl --image=radial/busyboxplus:curl -it\nIf you don't see a command prompt, try pressing enter.\n[ root@curl:/ ]$\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u6267\u884c",(0,l.jsx)(n.code,{children:"nslookup kubernetes.default"}),"\u786e\u8ba4\u89e3\u6790\u6b63\u5e38"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"nslookup kubernetes.default\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"[ root@curl:/ ]$ nslookup kubernetes.default\nServer:    10.96.0.10\nAddress 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local\n\nName:      kubernetes.default\nAddress 1: 10.96.0.1 kubernetes.default.svc.cluster.local\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u5176\u4ed6\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",children:"\u5176\u4ed6\u8282\u70b9\u52a0\u5165\u96c6\u7fa4"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="worker"',children:"kubeadm join 10.211.55.15:6443 --token abcdef.0123456789abcdef \\\n --discovery-token-ca-cert-hash sha256:9c0eb6268da17c2ca1394adc31fd0a1bd0adf4f0f59e1610a274d4c3dbe33a44\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5728",(0,l.jsx)(n.code,{children:"master"}),"\u8282\u70b9\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"kubectl get node\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"root@node15:~# kubectl get node\nNAME     STATUS   ROLES           AGE   VERSION\nnode15   Ready    control-plane   23h   v1.29.0\nnode16   Ready    <none>          23h   v1.29.0\nnode17   Ready    <none>          23h   v1.29.0\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u5e38\u7528\u7ec4\u4ef6\u90e8\u7f72",children:"\u5e38\u7528\u7ec4\u4ef6\u90e8\u7f72"}),"\n",(0,l.jsxs)(n.h3,{id:"\u90e8\u7f72ingress-nginx",children:["\u90e8\u7f72",(0,l.jsx)(n.code,{children:"ingress-nginx"})]}),"\n",(0,l.jsx)(n.p,{children:"\u5c06 node16 \u4f5c\u4e3a\u8fb9\u7f18\u8282\u70b9\uff0c\u6253\u4e0aLabel\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"kubectl label node node16 node-role.kubernetes.io/edge=\n"})}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsx)(n.p,{children:"\u5177\u6709 node-role.kubernetes.io/control-plane \u6807\u8bb0\u7684\u8282\u70b9\u4e0d\u53ef\u7528\u4e8e\u8c03\u5ea6\u3002\u8fd9\u53ef\u80fd\u662f\u63a7\u5236\u5e73\u9762\u8282\u70b9\uff0c\u901a\u5e38\u4e0d\u5e94\u8be5\u7528\u4e8e\u8c03\u5ea6\u5de5\u4f5c\u8d1f\u8f7d\u3002"})}),"\n",(0,l.jsx)(n.p,{children:"\u4e0b\u8f7dingress-nginx\u7684helm chart:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"wget https://github.com/kubernetes/ingress-nginx/releases/download/helm-chart-4.9.0/ingress-nginx-4.9.0.tgz\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5bfc\u51fa\u9ed8\u8ba4\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"helm show values ingress-nginx-4.9.0.tgz >> values.yaml\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u81ea\u5b9a\u4e49",(0,l.jsx)(n.code,{children:"ingress-nginx"}),"\u914d\u7f6e"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="values.yaml" showLineNumbers {11-15,18,20}',children:'controller:\n  ingressClassResource:\n    name: nginx\n    enabled: true\n    default: true\n    controllerValue: "k8s.io/ingress-nginx"\n  admissionWebhooks:\n    enabled: false\n  replicaCount: 1\n  image:\n    # registry: registry.k8s.io\n    # image: ingress-nginx/controller\n    # tag: "v1.9.5"\n    registry: docker.io\n    image: unreachableg/registry.k8s.io_ingress-nginx_controller\n    tag: "v1.9.5"\n    digest: sha256:bdc54c3e73dcec374857456559ae5757e8920174483882b9e8ff1a9052f96a35\n  hostNetwork: true\n  nodeSelector:\n    node-role.kubernetes.io/edge: \'\'\n  affinity:\n    podAntiAffinity:\n        requiredDuringSchedulingIgnoredDuringExecution:\n        - labelSelector:\n            matchExpressions:\n            - key: app\n              operator: In\n              values:\n              - nginx-ingress\n            - key: component\n              operator: In\n              values:\n              - controller\n          topologyKey: kubernetes.io/hostname\n  tolerations:\n      - key: node-role.kubernetes.io/master\n        operator: Exists\n        effect: NoSchedule\n      - key: node-role.kubernetes.io/master\n        operator: Exists\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u62c9\u53d6\u955c\u50cf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"crictl --runtime-endpoint=unix:///run/containerd/containerd.sock pull unreachableg/registry.k8s.io_ingress-nginx_controller:v1.9.5\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5b89\u88c5",(0,l.jsx)(n.code,{children:"ingress-nginx"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",metastring:'title="master"',children:"helm install ingress-nginx ingress-nginx-4.9.0.tgz --create-namespace -n ingress-nginx -f ingress-nginx-values.yaml\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u8bbf\u95ee ",(0,l.jsx)(n.a,{href:"http://10.211.55.16",children:"http://10.211.55.16"})," \u8fd4\u56de\u9ed8\u8ba4\u7684 nginx 404 \u9875\uff0c\u5219\u90e8\u7f72\u5b8c\u6210\u3002"]}),"\n",(0,l.jsx)(n.h2,{id:"\u95ee\u9898",children:"\u95ee\u9898"}),"\n",(0,l.jsxs)(n.h3,{id:"\u5b89\u88c5-kubeadm-\u548c-kubectl-\u65f6\u65e0\u6cd5\u751f\u6210-kubernetes-apt-keyringgpg",children:["\u5b89\u88c5 kubeadm \u548c kubectl \u65f6\u65e0\u6cd5\u751f\u6210 ",(0,l.jsx)(n.code,{children:"kubernetes-apt-keyring.gpg"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u5b89\u88c5",(0,l.jsx)(n.code,{children:"gnupg"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"apt install -y gnupg\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"\u5b89\u88c5-calico-\u540e\u6ca1\u6709\u770b\u5230calico-system\u76f8\u5173\u7684-pod",children:["\u5b89\u88c5 Calico \u540e\u6ca1\u6709\u770b\u5230",(0,l.jsx)(n.code,{children:"calico-system"}),"\u76f8\u5173\u7684 pod"]}),"\n",(0,l.jsxs)(n.p,{children:["\u5728\u521d\u59cb\u5316\u96c6\u7fa4\u7684\u65f6\u5019\u9700\u8981\u6307\u5b9a pod \u7684\u5b50\u7f51\uff1a",(0,l.jsx)(n.code,{children:"podSubnet: 192.168.0.0/16"})]}),"\n",(0,l.jsx)(n.h3,{id:"\u90e8\u7f72ingress-nginx\u65f6pod-\u4e00\u76f4\u5904\u4e8e-pending-\u72b6\u6001",children:"\u90e8\u7f72ingress-nginx\u65f6\uff0cpod \u4e00\u76f4\u5904\u4e8e Pending \u72b6\u6001"}),"\n",(0,l.jsx)(n.p,{children:"\u67e5\u770b pod \u4fe1\u606f\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl describe pod <pod-name> -n <namespace>\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"0/3 nodes are available: 1 node(s) had untolerated taint {node-role.kubernetes.io/control-plane: }, 2 node(s) didn't match Pod's node affinity/selector. preemption: 0/3 nodes are available: 3 Preemption is not helpful for scheduling.\n"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Untolerated Taint\uff1a \u5177\u6709 node-role.kubernetes.io/control-plane \u6807\u8bb0\u7684\u8282\u70b9\u4e0d\u53ef\u7528\u4e8e\u8c03\u5ea6\u3002\u8fd9\u53ef\u80fd\u662f\u63a7\u5236\u5e73\u9762\u8282\u70b9\uff0c\u901a\u5e38\u4e0d\u5e94\u8be5\u7528\u4e8e\u8c03\u5ea6\u5de5\u4f5c\u8d1f\u8f7d\u3002"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Node Affinity/Selector\uff1a Pod \u7684 node affinity \u6216 selector \u8981\u6c42\u6ca1\u6709\u4e0e\u4efb\u4f55\u8282\u70b9\u5339\u914d\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u89e3\u51b3 Untolerated Taint \u95ee\u9898\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"a. \u4e0d\u4f7f\u7528\u63a7\u5236\u5e73\u9762\u8282\u70b9\uff1a\n\u5982\u679c\u4f60\u7684\u96c6\u7fa4\u4e2d\u6709\u63a7\u5236\u5e73\u9762\u8282\u70b9\uff0c\u5e76\u4e14\u5b83\u4eec\u6709 taint\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u4e0d\u5728\u8fd9\u4e9b\u8282\u70b9\u4e0a\u8c03\u5ea6\u5de5\u4f5c\u8d1f\u8f7d\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 nodeSelector \u6216 nodeAffinity \u6765\u9009\u62e9\u975e\u63a7\u5236\u5e73\u9762\u8282\u70b9\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'affinity:\n  nodeAffinity:\n    requiredDuringSchedulingIgnoredDuringExecution:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: node-role.kubernetes.io/control-plane\n          operator: NotIn\n          values:\n          - "true"\n'})}),"\n",(0,l.jsx)(n.p,{children:"b. \u5bb9\u5fcd\u63a7\u5236\u5e73\u9762\u8282\u70b9\uff1a\n\u5982\u679c\u4f60\u786e\u5b9e\u9700\u8981\u4f7f\u7528\u63a7\u5236\u5e73\u9762\u8282\u70b9\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u5728 Pod \u7684\u8c03\u5ea6\u89c4\u5219\u4e2d\u5bb9\u5fcd\u8fd9\u4e9b\u8282\u70b9\u7684 taint\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"tolerations:\n- key: node-role.kubernetes.io/control-plane\n  effect: NoSchedule\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u89e3\u51b3 Node Affinity/Selector \u95ee\u9898\uff1a\n\u68c0\u67e5 Pod \u7684\u5b9a\u4e49\u6587\u4ef6\uff0c\u786e\u4fdd nodeAffinity \u6216 nodeSelector \u90e8\u5206\u6ca1\u6709\u9650\u5236\u592a\u4e25\u683c\uff0c\u5bfc\u81f4\u6ca1\u6709\u53ef\u7528\u8282\u70b9\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"affinity:\n  nodeAffinity:\n    requiredDuringSchedulingIgnoredDuringExecution:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: <key>\n          operator: In\n          values:\n          - <value>\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6216\u8005"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"nodeSelector:\n<key>: <value>\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u53c2\u8003",children:"\u53c2\u8003"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://blog.frognew.com/2023/12/kubeadm-install-kubernetes-1.29.html",children:"\u4f7f\u7528kubeadm\u90e8\u7f72Kubernetes 1.29"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://docs.tigera.io/calico/latest/getting-started/kubernetes/quickstart",children:"Quickstart for Calico on Kubernetes"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://juejin.cn/post/7305328476562522152",children:"K8s\u5b89\u88c5"})}),"\n",(0,l.jsx)(n.h2,{id:"\u5176\u4ed6",children:"\u5176\u4ed6"}),"\n",(0,l.jsx)(n.h3,{id:"\u4e0d\u4f7f\u7528-calico-\u9ed8\u8ba4\u7684-pod-\u5b50\u7f51-1921680016",children:"\u4e0d\u4f7f\u7528 Calico \u9ed8\u8ba4\u7684 pod \u5b50\u7f51 192.168.0.0/16"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://cloud.tencent.com/developer/article/2255721",children:"kubernetes\u5b89\u88c5\u4f7f\u7528calico\u4f5c\u4e3a\u96c6\u7fa4cni"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://cloud.tencent.com/developer/article/2353434",children:"\u4e91\u539f\u751f | k8s\u7f51\u7edc\u4e4bcalico\u7ec4\u4ef6\u591a\u65b9\u5f0f\u5feb\u901f\u90e8\u7f72\u53ca\u4f7f\u7528calicoctl\u7ba1\u7406\u7ef4\u62a4\u7f51\u7edc"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/tigera-operator.yaml",children:"https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/tigera-operator.yaml"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/calico.yaml",children:"https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/calico.yaml"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/custom-resources.yaml",children:"https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/custom-resources.yaml"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}}}]);